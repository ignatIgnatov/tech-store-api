spring:
    cache:
        type: caffeine
        cache-names:
            - products
            - manufacturers
            - parameters
            - parameterOptions
            - categoriesByExternalId
            - manufacturersByExternalId
            - parametersByCategory
            - productsByCategory
        caffeine:
            spec: maximumSize=10000,expireAfterWrite=1h,expireAfterAccess=30m
    application:
        name: tech-store-api

    # Database Configuration
    datasource:
        url: jdbc:postgresql://postgres:5432/${POSTGRES_DB}
        username: ${POSTGRES_USER}
        password: ${POSTGRES_PASSWORD}
        driver-class-name: org.postgresql.Driver

    # JPA/Hibernate Configuration
    jpa:
        hibernate:
            ddl-auto: update
        show-sql: false
        properties:
            hibernate:
                jdbc:
                    batch_size: 30
                order_inserts: true
                order_updates: true
                format_sql: true
                use_sql_comments: true
                default_batch_fetch_size: 20
                search:
                    backend:
                        type: lucene
                        directory:
                            root: ${SPRING_JPA_PROPERTIES_HIBERNATE_SEARCH_BACKEND_DIRECTORY_ROOT}
                    schema_management:
                        strategy: create-or-update
                    automatic_indexing:
                        enabled: true

    # Connection Pool Configuration
    hikari:
        maximum-pool-size: 3
        minimum-idle: 10
        connection-timeout: 10000
        idle-timeout: 300000
        max-lifetime: 1800000
        leak-detection-threshold: 5000

    # Jackson Configuration
    jackson:
        serialization:
            write-dates-as-timestamps: false
            fail-on-empty-beans: false
        deserialization:
            fail-on-unknown-properties: false
        default-property-inclusion: non_null
        mvc:
            contentnegotiation:
                favor-format: false
                favor-path-extension: false
                favor-parameter: false
                media-types:
                    json: application/json
                    xml: application/xml

    # Multipart Configuration (for file uploads)
    servlet:
        multipart:
            max-file-size: 10MB
            max-request-size: 50MB

    # Profile Configuration
    profiles:
        active: ${SPRING_PROFILES_ACTIVE}

aws:
    s3:
        access-key: ${AWS_ACCESS_KEY}
        secret-key: ${AWS_SECRET_KEY}
        bucket-name: ${AWS_S3_BUCKET_NAME}
        region: ${AWS_S3_REGION}

# ADD THIS NEW SECTION FOR TEKRA API
tekra:
    api:
        base-url: ${TEKRA_API_BASE_URL}
        access-token: ${TEKRA_API_ACCESS_TOKEN}
        enabled: true
        timeout-seconds: 30
        max-retries: 3

# Server Configuration
server:
    port: 8080
    error:
        include-message: always
        include-binding-errors: always
        include-stacktrace: on_param  # Include stack trace only when trace=true parameter is passed
        include-exception: false
    servlet:
        encoding:
            charset: UTF-8
            enabled: true

# LOGGING CONFIGURATION
logging:
    level:
        org.hibernate.engine.jdbc.connections.internal.DriverManagerConnectionProviderImpl: WARN
        org.hibernate.SQL: WARN
        org.hibernate.type.descriptor.sql: WARN
        org.hibernate.tool.schema: WARN
        com.zaxxer.hikari: WARN
        org.springframework.security.config.annotation.authentication.configuration.InitializeUserDetailsBeanManagerConfigurer: ERROR
        org.springframework.security.web.FilterChainProxy: WARN
        org.hibernate.type.descriptor.sql.BasicBinder: ERROR
        com.techstore: WARN
    pattern:
        console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"
        file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
    file:
        name: ${LOGGING_FILE_NAME}
    logback:
        rollingpolicy:
            max-file-size: 10MB
            max-history: 30
            total-size-cap: 300MB

# Application Specific Configuration
app:
    error:
        include-stack-trace: false
        include-root-cause: true
        max-error-details: 10
    sync:
        enabled: true
        cron: "0 0 3 * * *"
        batch-size: 30
        max-chunk-duration-minutes: 5

        tekra:
            enabled: true
            wildlife-surveillance-only: true
            auto-sync: false
            sync-cron: "0 0 2 * * ?"
            surveillance-categories:
                - videonablyudenie
                - ip-kameri
                - analogovi-kameri
                - dvr-nvr
                - signalizacii
                - kontrola-dostap
                - domofoni
                - pozharoizvesyavane
                - perimetrova-zashtita

    markup:
        default-percentage: 20.0
        max-percentage: 200.0
        min-percentage: -50.0

    # JWT Configuration
    jwt:
        secret: ${JWT_SECRET}
        expiration: ${JWT_EXPIRATION}
        refresh-expiration: ${JWT_REFRESH_EXPIRATION}

    # File Upload Configuration
    upload:
        directory: ${UPLOAD_DIR}
        max-file-size: 10485760
        allowed-extensions: jpg,jpeg,png,gif,webp

    # Admin Configuration
    admin:
        default-username: ${ADMIN_USERNAME}
        default-password: ${ADMIN_PASSWORD}
        default-email: ${ADMIN_EMAIL}

    # Pagination Configuration
    pagination:
        default-size: 20
        max-size: 100

# Management/Actuator Configuration
management:
    endpoints:
        web:
            exposure:
                include: health,info,metrics
    endpoint:
        health:
            show-details: when-authorized

# OpenAPI/Swagger Configuration
springdoc:
    api-docs:
        path: /v3/api-docs
    swagger-ui:
        path: /swagger-ui.html
        enabled: true
        operations-sorter: method
        tags-sorter: alpha

vali:
    api:
        base-url: ${VALI_API_BASE_URL}
        token: ${VALI_API_TOKEN}
        timeout: 30000
        retry-attempts: 3
        retry-delay: 1000

excluded:
    categories:
        external-ids: ${VALI_EXCLUDED_CATEGORIES_IDS}